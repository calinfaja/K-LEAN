{
  "project": {
    "name": "k-lean",
    "package_name": "kln-ai",
    "version": "1.0.0b2",
    "description": "Multi-model code review and knowledge capture system for Claude Code",
    "generated": "2026-01-03",
    "python_version": ">=3.9",
    "license": "Apache-2.0",
    "lines_of_code": 5350
  },
  "entry_points": {
    "kln": "src/klean/cli.py:main",
    "kln-smol": "src/klean/smol/cli.py:main"
  },
  "core_modules": {
    "cli": {
      "path": "src/klean/cli.py",
      "exports": ["main", "init", "install", "uninstall", "status", "doctor", "start", "stop", "multi", "model", "admin", "configure_statusline"],
      "command_structure": {
        "root": ["init", "install", "uninstall", "start", "stop", "status", "doctor", "multi"],
        "model_subgroup": ["list", "add", "remove", "test"],
        "admin_subgroup": ["sync", "debug", "test"]
      },
      "purpose": "Primary CLI with Click commands, organized into root + 2 subgroups"
    },
    "model_utils": {
      "path": "src/klean/model_utils.py",
      "exports": ["extract_model_name", "parse_model_id", "is_thinking_model"],
      "purpose": "Model name extraction, parsing, and thinking model detection"
    },
    "config_generator": {
      "path": "src/klean/config_generator.py",
      "exports": ["generate_litellm_config", "load_config_yaml", "merge_models_into_config", "add_model_to_config", "remove_model_from_config", "list_models_in_config"],
      "purpose": "LiteLLM configuration generation and management with smart merging"
    },
    "discovery": {
      "path": "src/klean/discovery.py",
      "exports": ["list_models", "get_model", "is_available", "clear_cache"],
      "purpose": "Dynamic model discovery from LiteLLM proxy"
    },
    "smol": {
      "path": "src/klean/smol/",
      "modules": 16,
      "purpose": "SmolAgents-based agent system"
    },
    "executor": {
      "path": "src/klean/smol/executor.py",
      "exports": ["SmolKLNExecutor"],
      "purpose": "Single agent execution with tool use"
    },
    "multi_agent": {
      "path": "src/klean/smol/multi_agent.py",
      "exports": ["MultiAgentExecutor"],
      "purpose": "Multi-agent orchestration and consensus"
    },
    "multi_config": {
      "path": "src/klean/smol/multi_config.py",
      "exports": ["get_3_agent_config", "get_4_agent_config", "get_models"],
      "purpose": "Agent configuration (3 or 4 agent variants)"
    },
    "loader": {
      "path": "src/klean/smol/loader.py",
      "exports": ["parse_agent_file", "load_agent", "list_available_agents", "AgentConfig", "Agent"],
      "purpose": "Agent definition loading from markdown"
    },
    "tools": {
      "path": "src/klean/smol/tools.py",
      "exports": ["read_file", "grep", "search_files", "git_diff", "git_status", "git_log", "list_directory", "get_file_info", "get_default_tools"],
      "purpose": "Agent tools for code analysis"
    },
    "models": {
      "path": "src/klean/smol/models.py",
      "purpose": "LiteLLM model wrapper, thinking model support"
    },
    "context": {
      "path": "src/klean/smol/context.py",
      "purpose": "Git context extraction (status, diff, log)"
    }
  },
  "slash_commands": {
    "kln:quick": {"file": "data/commands/kln/quick.md", "purpose": "Fast single-model review (~30s)"},
    "kln:multi": {"file": "data/commands/kln/multi.md", "purpose": "Multi-model consensus (~60s)"},
    "kln:agent": {"file": "data/commands/kln/agent.md", "purpose": "SmolKLN specialist agents (~2min)"},
    "kln:rethink": {"file": "data/commands/kln/rethink.md", "purpose": "Contrarian debugging"},
    "kln:learn": {"file": "data/commands/kln/learn.md", "purpose": "Context-aware learning extraction"},
    "kln:remember": {"file": "data/commands/kln/remember.md", "purpose": "End-of-session capture"},
    "kln:doc": {"file": "data/commands/kln/doc.md", "purpose": "Documentation generation"},
    "kln:status": {"file": "data/commands/kln/status.md", "purpose": "System status"},
    "kln:help": {"file": "data/commands/kln/help.md", "purpose": "Command reference"}
  },
  "hooks": {
    "session-start": {"file": "data/hooks/session-start.sh", "trigger": "SessionStart", "purpose": "Auto-start LiteLLM + Knowledge Server"},
    "user-prompt-handler": {"file": "data/hooks/user-prompt-handler.sh", "trigger": "UserPromptSubmit", "keywords": ["FindKnowledge", "SaveInfo", "asyncReview", "asyncConsensus"]},
    "post-bash-handler": {"file": "data/hooks/post-bash-handler.sh", "trigger": "PostToolUse:Bash", "purpose": "Post-commit docs, timeline"},
    "post-web-handler": {"file": "data/hooks/post-web-handler.sh", "trigger": "PostToolUse:Web*", "purpose": "Auto-capture URLs"}
  },
  "agents": {
    "code-reviewer": {"file": "data/agents/code-reviewer.md", "specialty": "OWASP, SOLID, code quality"},
    "security-auditor": {"file": "data/agents/security-auditor.md", "specialty": "Vulnerabilities, auth, crypto"},
    "debugger": {"file": "data/agents/debugger.md", "specialty": "Root cause analysis"},
    "performance-engineer": {"file": "data/agents/performance-engineer.md", "specialty": "Profiling, optimization"},
    "rust-expert": {"file": "data/agents/rust-expert.md", "specialty": "Ownership, lifetimes, unsafe"},
    "c-pro": {"file": "data/agents/c-pro.md", "specialty": "C99/C11, POSIX, embedded"},
    "arm-cortex-expert": {"file": "data/agents/arm-cortex-expert.md", "specialty": "ARM MCU, real-time"},
    "orchestrator": {"file": "data/agents/orchestrator.md", "specialty": "Multi-agent coordination"}
  },
  "agent_tools": ["read_file", "search_files", "grep", "knowledge_search", "get_complexity"],
  "knowledge_db": {
    "storage": ".knowledge-db/",
    "backend": "fastembed-hybrid",
    "models": {
      "dense": "BAAI/bge-small-en-v1.5",
      "sparse": "Qdrant/bm42-all-minilm-l6-v2-attentions",
      "reranker": "Xenova/ms-marco-MiniLM-L-6-v2"
    },
    "search_pipeline": ["dense", "sparse", "rrf_fusion", "reranking"],
    "server_type": "unix_socket",
    "scripts": {
      "core": "data/scripts/knowledge_db.py",
      "server": "data/scripts/knowledge-server.py",
      "search": "data/scripts/knowledge-search.py",
      "capture": "data/scripts/knowledge-capture.py",
      "query_cli": "data/scripts/knowledge-query.sh",
      "init": "data/scripts/kb-init.sh"
    }
  },
  "scripts": {
    "count": 35,
    "review": ["quick-review.sh", "consensus-review.sh", "second-opinion.sh"],
    "service": ["setup-litellm.sh", "start-litellm.sh", "health-check.sh", "session-helper.sh"],
    "utility": ["timeline-query.sh", "smart-capture.sh", "fact-extract.sh", "async-dispatch.sh"]
  },
  "config_files": {
    "pyproject": "pyproject.toml",
    "litellm_nanogpt": "config/litellm/config.yaml",
    "litellm_openrouter": "config/litellm/openrouter.yaml",
    "serena": ".serena/project.yml"
  },
  "dependencies": {
    "core": ["click>=8.0.0", "rich>=13.0.0", "pyyaml>=6.0.0", "httpx>=0.27.0"],
    "knowledge": ["fastembed>=0.3.0", "numpy>=1.24.0"],
    "agents": ["smolagents[litellm]>=1.17.0", "ddgs>=6.0.0", "markdownify>=0.11.0", "lizard>=1.17.0"],
    "optional": {
      "agent-sdk": ["anthropic>=0.34.0,<1.0.0"],
      "telemetry": ["arize-phoenix>=4.0", "opentelemetry-sdk", "opentelemetry-exporter-otlp"],
      "toon": ["python-toon>=0.1.0"]
    }
  },
  "tests": {
    "framework": "pytest",
    "path": "tests/",
    "count": 11,
    "files": ["test_discovery.py", "test_loader.py", "test_context.py", "test_memory.py", "test_tools_citations.py", "test_doctor_hooks.py", "test_async_completion.py", "test_llm_client.py", "test_cli_integration.py", "test_init_command.py", "test_model_management.py"]
  },
  "file_counts": {
    "python": 51,
    "shell": 35,
    "markdown": 50,
    "yaml_toml": 12,
    "tests": 11
  },
  "directories": {
    "installed": {
      "scripts": "~/.claude/scripts/",
      "commands": "~/.claude/commands/kln/",
      "hooks": "~/.claude/hooks/",
      "config": "~/.config/litellm/",
      "runtime": "~/.klean/"
    },
    "per_project": {
      "knowledge_db": ".knowledge-db/"
    }
  },
  "key_patterns": [
    "Dynamic model discovery from LiteLLM",
    "First-available model (user controls priority via config order)",
    "Agent definitions: YAML frontmatter + markdown system prompt",
    "Per-project knowledge DB in .knowledge-db/",
    "Hook system for Claude Code integration"
  ]
}
